(** Utf8StringsTest.Mod - Tests for Utf8Strings.Mod.

Copyright (C) 2025

Released under The 3-Clause BSD License.
*)

MODULE Utf8StringsTest;

IMPORT Utf8Strings, Tests;

VAR
  ts: Tests.TestSet;

PROCEDURE TestLength*(): BOOLEAN;
VAR s: ARRAY 64 OF CHAR; len: INTEGER; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€";
  len := Utf8Strings.Length(s);
  Tests.ExpectedInt(3, len, "Length('AÎ©ðŸ˜€')", test);
  RETURN test
END TestLength;

PROCEDURE TestCopy*(): BOOLEAN;
VAR s, t: ARRAY 64 OF CHAR; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€";
  Utf8Strings.Copy(s, t);
  Tests.ExpectedString(s, t, "Copy", test);
  RETURN test
END TestCopy;

PROCEDURE TestInsert*(): BOOLEAN;
VAR s, u: ARRAY 64 OF CHAR; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€";
  Utf8Strings.Insert(s, 1, "X", u);
  Tests.ExpectedString("AXÎ©ðŸ˜€", u, "Insert 'X' at pos 1", test);
  RETURN test
END TestInsert;

PROCEDURE TestAppend*(): BOOLEAN;
VAR s, u: ARRAY 64 OF CHAR; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€";
  Utf8Strings.Append(s, "!", u);
  Tests.ExpectedString("AÎ©ðŸ˜€!", u, "Append '!'", test);
  RETURN test
END TestAppend;

PROCEDURE TestDelete*(): BOOLEAN;
VAR s, u: ARRAY 64 OF CHAR; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€";
  Utf8Strings.Delete(s, 1, 1, u);
  Tests.ExpectedString("AðŸ˜€", u, "Delete at pos 1", test);
  RETURN test
END TestDelete;

PROCEDURE TestExtract*(): BOOLEAN;
VAR s, u: ARRAY 64 OF CHAR; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€";
  Utf8Strings.Extract(s, 1, 2, u);
  Tests.ExpectedString("Î©ðŸ˜€", u, "Extract 2 from pos 1", test);
  RETURN test
END TestExtract;

PROCEDURE TestPos*(): BOOLEAN;
VAR s: ARRAY 64 OF CHAR; pos: INTEGER; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€Î©A";
  pos := Utf8Strings.Pos("A", s, 0);
  Tests.ExpectedInt(0, pos, "Pos('A', ... , 0)", test);

  pos := Utf8Strings.Pos("Î©", s, 0);
  Tests.ExpectedInt(1, pos, "Pos('Î©', ... , 0)", test);

  pos := Utf8Strings.Pos("ðŸ˜€", s, 0);
  Tests.ExpectedInt(2, pos, "Pos('ðŸ˜€', ... , 0)", test);

  pos := Utf8Strings.Pos("Î©", s, 2);
  Tests.ExpectedInt(3, pos, "Pos('Î©', ... , 2)", test);

  pos := Utf8Strings.Pos("Z", s, 0);
  Tests.ExpectedInt(-1, pos, "Pos('Z', ... , 0)", test);

  pos := Utf8Strings.Pos("A", s, 4);
  Tests.ExpectedInt(4, pos, "Pos('A', ... , 4)", test);

  pos := Utf8Strings.Pos("A", s, 5);
  Tests.ExpectedInt(-1, pos, "Pos('A', ... , 5)", test);

  pos := Utf8Strings.Pos("AÎ©ðŸ˜€Î©A", s, 0);
  Tests.ExpectedInt(0, pos, "Pos(full, ... , 0)", test);

  pos := Utf8Strings.Pos("AÎ©ðŸ˜€Î©AÎ©", s, 0);
  Tests.ExpectedInt(-1, pos, "Pos(longer, ... , 0)", test);

  RETURN test
END TestPos;

PROCEDURE TestReplace*(): BOOLEAN;
VAR s, expected: ARRAY 64 OF CHAR; test: BOOLEAN;
BEGIN
  test := TRUE;
  s := "AÎ©ðŸ˜€";
  Utf8Strings.Replace("X", 1, s);
  expected := "AXðŸ˜€";
  Tests.ExpectedString(expected, s, "Replace 'Î©' with 'X'", test);

  s := "AÎ©ðŸ˜€";
  Utf8Strings.Replace("Z", 0, s);
  expected := "ZÎ©ðŸ˜€";
  Tests.ExpectedString(expected, s, "Replace 'A' with 'Z'", test);

  s := "AÎ©ðŸ˜€";
  Utf8Strings.Replace("!", 2, s);
  expected := "AÎ©!";
  Tests.ExpectedString(expected, s, "Replace 'ðŸ˜€' with '!'", test);

  s := "AÎ©ðŸ˜€";
  Utf8Strings.Replace("XY", 1, s);
  expected := "AXY";
  Tests.ExpectedString(expected, s, "Replace 'Î©ðŸ˜€' with 'XY'", test);

  s := "AÎ©ðŸ˜€";
  Utf8Strings.Replace("", 1, s);
  expected := "AÎ©ðŸ˜€";
  Tests.ExpectedString(expected, s, "Replace with '' (Oakwood: no-op)", test);

  RETURN test
END TestReplace;

BEGIN
  Tests.Init(ts, "Utf8Strings Tests");
  Tests.Add(ts, TestLength);
  Tests.Add(ts, TestCopy);
  Tests.Add(ts, TestInsert);
  Tests.Add(ts, TestAppend);
  Tests.Add(ts, TestDelete);
  Tests.Add(ts, TestExtract);
  Tests.Add(ts, TestPos);
  Tests.Add(ts, TestReplace);
  ASSERT(Tests.Run(ts));
END Utf8StringsTest.